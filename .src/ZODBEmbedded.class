' Gambas class file

Inherits ZODB

Public dbfile As String

Public Sub _new(dbfile_ As String)
  Me.dbfile = dbfile_
  Me.type = "ZODBEmbedded"
  
  Me.connection_settings["connection type"] = "ZODBEmbedded"
  Me.connection_settings["dbfile"] = dbfile_
End

Public Sub connect(Optional caller As Object = Null)
  ' connect to the ZODB database
  Me.engine = New ZODBEngine(Me.temporary_folder &/ Me.connection_settings["dbfile"])
  Me.engine.connect()
End

Public Sub query(query_ As String) As Variant
  ' execute a query and return the results
  Dim result As Variant
  If Not Me.engine.is_open Then
    Try Me.engine.close()
    Me.engine.connect()
  Endif
  
  result = Me.engine.query(query_)    
  Return result
End

